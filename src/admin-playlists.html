<!DOCTYPE html>
<html lang="zh-Hans">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>歌单管理页面</title>
    <link rel="stylesheet" href="./css/default.css">
</head>

<body>
    <div class="page">
        <aside>
            <div class="newMusic">
            </div>
            <div id="musicList-container">
            </div>
            <div class="uploadArea">
                <div id="uploadContainer" class="draggable">
                    <div id="uploadButton" class="clickable">
                        <span>点击或拖曳上传</span>
                        <p>文件大小不能超过 20MB</p>
                    </div>
                </div>
            </div>
        </aside>
        <main>
            <div class="playlistForm-wrapper">
                <form class="playlistForm" action="">
                </form>
            </div>
        </main>
        <footer>
            <li class='search-area'>
                <input id="search" type="text" style="background:#EBECEC;">
                <ol id="searchResult"></ol>
            </li>
        </footer>
    </div>
    <script src="./../node_modules/leancloud-storage/dist/av-min.js"></script>
    <script src="./js/initializers/av.js"></script>
    <script src="../node_modules/jquery/dist/jquery.min.js"></script>
    <script src="../vendors/moxie.js"></script>
    <script src="../node_modules/plupload/js/plupload.min.js"></script>
    <script src="../node_modules/qiniu-js/dist/qiniu.min.js"></script>
    <script src="./js/admin/event-hub.js"></script>
    <script src="./js/admin-playlists/event-hub.js"></script>
    <script src="./js/admin-playlists/music-list.js"></script>
    <script src="./js/admin-playlists/music-form.js"></script>
    <script src="./js/admin-playlists/new-music.js"></script>
    <script src="./js/admin-playlists/search-music.js"></script>

    <script>
        {
            let view = {
                el: '.playlistForm-wrapper',
                init() {
                    this.$el = $(this.el)
                    this.$form = this.$el.find('form')
                }

            }
            let model = {
                create(data) {
                    var Playlist = AV.Object.extend('Playlist')
                    var playlist = new Playlist()
                    playlist.set('name', data.name)
                    playlist.set('summary', data.summary)
                    playlist.save().then(newPlaylist => {
                        console.log(newPlaylist)
                    }, error => {
                        console.error(error)
                    })
                }
            }
            let controller = {
                init(view, model) {
                    this.view = view
                    this.view.init()
                    this.model = model
                    this.bindEvents()
                },
                bindEvents() {
                    this.view.$el.on('submit', 'form', (e) => {
                        e.preventDefault()
                        let form = this.view.$form.get(0)
                        let keys = ['name', 'summary']
                        let data = {}
                        keys.reduce((prev, item) => {
                            prev[item] = form[item].value.trim()
                            return prev
                        }, data)
                        console.log(data)
                        this.model.create(data)
                    })
                }
            }
            controller.init(view, model)
        }

        /* var Song = AV.Object.extend('Song')
        var song = new Song()
        song.set('name', '2222')


        var Playlist = AV.Object.extend('Playlist')
        var playlist = new Playlist()
        playlist.set('name', '测试标题22')
        playlist.set('summary', "测试简介222")

        song.set('dependent', playlist) // Song属于一个歌单

        song.save().then(
            newSong => {
                let { id, attributes } = newSong
                Object.assign(this.data, {
                    id: id,
                    ...attributes

                    /* name: attributes.name,
                    artist: attributes.artist,
                    url: attributes.url */
          /*       })
            },
            error => {
                // 异常处理
                console.error(error.message)
            }
        ) */
        /*  playlist.save().then(newPlaylist => {
            console.log(newPlaylist)
        }, error => {
            console.error(error)
        }) */
    </script>
</body>

</html>